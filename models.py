#Hail, Steven. 2018. Economics for Sustainable Prosperity. Palgrave Macmillan.
import numpy as np
from numpy.linalg import solve
import matplotlib.pyplot as plt
import japanize_matplotlib #日本語を有効化するモジュールをインポート
plt.rcParams['xtick.direction'] = 'in' #x軸の目盛線が内向き('in')か外向き('out')か双方向か('inout')
plt.rcParams['ytick.direction'] = 'in' #y軸の目盛線が内向き('in')か外向き('out')か双方向か('inout')
plt.rcParams['xtick.major.width'] = 1 #x軸主目盛り線の線幅
plt.rcParams['ytick.major.width'] = 1 #y軸主目盛り線の線幅
plt.rcParams['font.size'] = 10.5 #フォントの大きさ
plt.rcParams['axes.linewidth'] = 1 # 軸の線幅edge linewidth。囲みの太さ

##変数
#国内総生産
Y = [11581.20]
#企業の利払前・税引前利益
EBIT = [4562.29]
#賃金支払額
WB = [7018.91]
#海外収支
NX = [-202.42]
#投資額
I = [2712.40]
#資本蓄積率
g_k = [0.06389]
#稼働率
u = [1.312]
#資本ストック
Y_cap = [10217.143]
#評価比率
q = [0.5153]
#消費額
C = [7408.46]
#限界消費性向
α_1 = [0.74]
#総定期所得
Y_r = [9605.16]
#家計純資産
V = [17364.7]
#ローンの貸出利率
r_I = [0.04]
#ヘイズ=サイモンズ所得
Y_hs = [8120]
#キャピタル・ゲイン
CG = [311.147]
#家計の借入増加額
ΔL_h = [322.52]
#銀行への利払後利益
F = [4166.33]
#配当金
FD = [1999.35]
#配当金支払後企業利益
FU = [2166.98]
#新規の発行株数
Δe = [3.0486]
#残りの投資を賄う資金
ΔL_f = [392.99]
#株式の市場清算価格
p_e = [51.414]
#株式のリターン割合
r_e = [0.21]
#政府支出額
G = [1662.76]
#税収
T = [1464.11]
#政府赤字
ΔB = [313.01]
#海外部門の政府債務需要
ΔB_o = [348.10]
#銀行が引き受ける政府債務
ΔB_b = [-35.09]
#銀行からの分配利益
FDB = [309.09]
#銀行の収入
FB = [413.31]
#準備預金増加額
ΔR = [104.22]
#家計預金需要
D_d = [14466.7]
#銀行預金供給
D_s = [14466.7]
#銀行預金
D = [14466.7]
#雇用量
N = [7018.91]
#労働力
LF = [7233]
#失業率
UN = [0.0296]

#企業保有固有ストック
K = [30738.97]
#家計の借入額
L_h = [8484.52]
#企業の借入額
L_f = [10291.99]
#銀行の資金供給額
L = [18776.31]
#銀行の資金供給額の上昇分
ΔL = [715.32]
#準備預金
R = [2708.62]
#政府の貨幣供給額
B = [6031.01]
#銀行の政府貨幣保有残高
B_b = [-1601.09]
#海外の政府貨幣保有残高
B_o = [7632.10]
#発行株式数
e = [223.0486]
#株式の上昇金額
Δp_e = [1.4143]

##パラメター
#政府支出の伸び率
g_g = 0.04
g_g_l = [0.04]
#税率
θ = 0.15
#国債金利
r = 0.02
r_l = [0.02]
#ソルベンシー比率
SOLR = 0.15
#企業のマークアップ率
μ = 0.65
#経常収支比率
Φ = 0.02
#補填投資比率
δ = 0.03
#資本蓄積率に関するパラメター
a_0 = 0.01
a_1 = 0.1
a_2 = 0.02
a_3 = 0.02
#基準稼働率
u_0 = 0.7
#基準評価率
q_0 = 1
#資本係数
COR = 3.5
#消費に関するパラメター
α_10 = 0.9
α_11 = 4
α_2 = 0.1
#銀行の金利に対するマークアップ率
π_b = 0.02
#借入増加額に関するパラメタ-
ζ = 1
#配当性向
POR = 0.5
#投資に占める株式の割合
γ = 0.1
#株式市場価格に関するパラメター
λ_0 = 0.6
λ_1 = 0.02
λ_2 = 0.38
#労働力の上昇率
g_LF = 0.04
#賃金単位
W = 1
#価格水準
P = 1.65
#労働生産性
APL = 1

def model():
    g_g_l.append(g_g)
    r_l.append(r)
    #潜在生産量
    Y_cap.append(K[-1]/COR)
    #限界消費性向
    α_1.append(α_10-α_11*r_I[-1])
    #消費
    C.append(α_1[-1]*Y_r[-1]*(1-θ)+α_1[-1]*ΔL_h[-1]+α_2*V[-1]-α_1[-1]*r_I[-1]*L_h[-1])
    #ローンの貸出利率
    r_I.append(r_l[-1]+π_b)
    #政府支出額
    G.append(G[-1]*(1+g_g_l[-1]))
    #資本蓄積係数
    g_k.append(a_0+a_1*(u[-1]-u_0)+a_2*(FU[-1]/K[-1])+a_3*(q[-1]-q_0))
    #投資額
    I.append((δ+g_k[-1])*K[-1])
    #海外収支
    NX.append(-Φ*(C[-1]+I[-1]))
    #GDPの式
    Y.append(C[-1]+I[-1]+G[-1]+NX[-1])
    #稼働率
    u.append(Y[-1]/Y_cap[-1])
    #企業の利払前・税引前利益
    EBIT.append((μ/(1+μ))*Y[-1])
    #賃金支払額
    WB.append(Y[-1]-EBIT[-1])
    #配当金
    FD.append(POR*F[-1])
    #銀行への利払後利益
    F.append(EBIT[-1]-r_I[-2]*L_f[-1])
    #配当金利払後利益
    FU.append(F[-1]-FD[-1])
    #新規株式発行数
    Δe.append(γ*q[-1]*I[-1]/p_e[-1])
    #企業の残りの投資を賄う借入額
    ΔL_f.append(I[-1]-FU[-1]-p_e[-1]*Δe[-1])
    #株式発行数
    e.append(e[-1]+Δe[-1])
    #株式の市場清算価格
    p_e.append((λ_0-λ_1*r_l[-2]+λ_2*r_e[-1])*V[-1]/e[-1])
    #株式のリターン
    r_e.append((FD[-1]+CG[-1])/(p_e[-2]*e[-2]))
    #株式の上昇金額
    Δp_e.append(p_e[-1]-p_e[-2])
    #キャピタルゲイン
    CG.append(Δp_e[-1]*e[-1])
    #企業の借入合計額
    L_f.append(L_f[-1]+ΔL_f[-1])
    #企業保有固有ストック
    K.append(K[-1]*(1+g_k[-1]))
    #評価比率
    q.append(p_e[-1]*e[-1]/(K[-1]-L_f[-1]))
    #海外部門の政府債務需要
    ΔB_o.append(-NX[-1]+r_l[-2]*B_o[-1])
    #海外部門の政府債務残高
    B_o.append(B_o[-1]+ΔB_o[-1])
    #銀行の収入
    FB.append(r_I[-2]*L_f[-1]+r_I[-2]*L_h[-1]+r_l[-2]*B_b[-1]-r_l[-2]*D[-1])
    #準備預金増加額
    ΔR.append((SOLR-R[-1]/(L_f[-1]+L_h[-1]))*(L_f[-1]+L_h[-1]))
    #準備預金
    R.append(R[-1]+ΔR[-1])
    #銀行からの分配利益
    FDB.append(FB[-1]-ΔR[-1])
    #総定期所得
    Y_r.append(WB[-1]+r_l[-2]*D[-1]+FD[-1]+FDB[-1])
    #ヘイグ=サイモンズ所得
    Y_hs.append(Y_r[-1]*(1-θ)+CG[-1]*(1-θ/2)-r_I[-2]*L_h[-1])
    #家計の借入増加額
    ΔL_h.append(ζ*(Y_hs[-1]-Y_hs[-2]))
    #家計の借入合計額
    L_h.append(L_h[-1]+ΔL_h[-1])
    #税収
    T.append(θ*Y_r[-1]+(θ/2)*CG[-1])
    #政府金融負債の増加額
    ΔB.append(-(T[-1]-G[-1]-r_l[-2]*B[-1]))
    #政府の金融負債残高
    B.append(B[-1]+ΔB[-1])
    #銀行の資金供給増加額
    ΔL.append(ΔL_h[-1]+ΔL_f[-1])
    #銀行の資金供給合計額
    L.append(ΔL[-1]+L[-1])
    #銀行が引き受ける政府債務増加額
    ΔB_b.append(ΔB[-1]-ΔB_o[-1])
    #銀行が引き受ける政府債務
    B_b.append(ΔB_b[-1]+B_b[-1])
    #銀行の預金供給
    D_s.append(L[-1]+B_b[-1]-R[-1])
    #銀行預金
    D.append(D_s[-1])
    #家計純資産
    V.append(D[-1]+p_e[-1]*e[-1]-L_h[-1])
    #銀行の預金需要
    D_d.append(V[-1]+L_h[-1]-p_e[-1]*e[-1])
    #雇用量
    N.append(WB[-1]/W)
    #労働力
    LF.append(LF[-1]*(1+g_LF))
    #失業率
    UN.append(1-N[-1]/LF[-1])


fig = plt.figure(figsize=(12, 6))
ax = fig.add_subplot(1,1,1)
Time = [i for i in range(0, 101)]

for t in range(1, 101):
    ##変化を加えない場合は下記の式のみで良い
    #model()
    ##変化を加えない場合は上記の式のみで良い

    ##変化を加える場合は下記の式
    if t < 5:
        model()
    elif t == 5:
        g_g = 0.02
        r = 0
        model()
    else:
        g_g = 0.04
        r = 0
        model()
    ##変化を加える場合は下記の式


#変化を加えない場合
Y_1 = [11581.2, 12138.613268083598, 12845.50625259158, 13808.013141936215, 14719.757693065396, 15573.772707440796, 16370.592090132372, 17079.27302655183, 17730.504190917272, 18327.112109556463, 18890.626043926193, 19434.007625362083, 19969.34254407021, 20505.987867903936, 21050.563558688267, 21608.931651470513, 22186.098199941734, 22787.128878706342, 23417.11455427397, 24081.231739472114, 24784.628393194336, 25532.29065232593, 26328.953840788596, 27179.03266763138, 28086.599514981546, 29055.381601861005, 30088.774010206078, 31189.856673430895, 32361.411079117366, 33605.93548836645, 34925.65893526253, 36322.55591324775, 37798.363245538356, 39354.600471805046, 40992.594412279446, 42713.50807693884, 44518.37369217377, 46408.12935363753, 48383.65867263212, 50445.83269886826, 52595.55336002638, 54833.79762975872, 57161.66161935524, 59580.40378625243, 62091.486471876175, 64696.61502824787, 67397.77386960118, 70197.25889023526, 73097.70581709247, 76102.1142067898, 79213.86694270889, 82436.74522939857, 85774.93921159254, 89233.05445826674, 92816.1146452207, 96529.56084149773, 100379.24785602101, 104371.4381327125, 108512.79369739685, 112810.36666064055, 117271.58877003621, 121904.2604858955, 126716.54002814449, 131716.9328113866, 136914.28165121764, 142317.75808920528, 147936.85514743166, 153781.38178684085, 159861.45930729408, 166187.51989153554, 172770.3074604072, 179620.8809727414, 186750.62027051637, 194171.23453815546, 201894.77341441138, 209933.64076622436, 218300.61110647008, 227008.84861181237, 236071.92867319853, 245503.86189013612, 255319.12040103087, 265532.6664258067, 276159.9828840056, 287217.10594176094, 298720.65933462017, 310687.8903102159, 323136.7070353007, 336085.7173155769, 349554.2684839836, 363562.4883234008, 378131.32690289844, 393282.59922231373, 409039.02857778076, 425424.2905804361, 442463.0577814801, 460181.0448786686, 478605.05450172507, 497763.0235966871, 517684.0704514691, 538398.5424265786, 559938.0644756571]
#5期のみ政府支出の伸び率縮小&5期以降政府金利が0
Y_2 = [11581.2, 12138.613268083598, 12845.50625259158, 13808.013141936215, 14719.757693065396, 15534.868827056285, 17332.496394636404, 18887.842117781645, 20129.921868814265, 21424.101466194243, 22343.284202315084, 23207.28227000273, 23869.47623860953, 24379.94538121365, 24737.96706718226, 24956.407963689093, 25074.291735244184, 25126.513849393476, 25156.61271385692, 25201.884240382587, 25293.766074134015, 25456.427228982895, 25707.251528074346, 26058.81655908136, 26520.1232430243, 27097.920881904996, 27797.41616206746, 28622.697879673382, 29576.93889610018, 30662.464324239034, 31880.777777388605, 33232.56018934903, 34717.66492692687, 36335.11026581047, 38083.07352091562, 39958.892198544985, 41959.07889485118, 44079.358297030994, 46314.733495459506, 48659.58686847879, 51107.817583791875, 53653.014201816746, 56288.65744598278, 59008.345315558676, 61806.03067120419, 64676.260319154986, 67614.40447746137, 70616.86623978773, 73681.26211316959, 76806.56670691913, 79993.2169761757, 83243.17385751277, 86559.94147231833, 89948.54614688062, 93415.47918365055, 96968.60854688335, 100617.06538113252, 104371.11159121373, 108241.99463897878, 112241.7953372881, 116383.27383416644, 120679.71826648193, 125144.79979843668, 129792.4370067087, 134636.67187577527, 139691.55905215553, 144971.06948902778, 150489.00919506463, 156258.95347654217, 162294.19681684172, 168607.71835579886, 175212.162795035, 182119.83644694462, 189342.71804874568, 196892.48386615163, 204780.54650451365, 213018.10672333566, 221616.2174114095, 230585.85872668505, 239938.0232428195, 249683.809781092, 259834.52445163354, 270401.78729202575, 281397.64278431603, 292834.67246228544, 304726.1077963541, 317085.9415683314, 329929.0360239953, 343271.22621705127, 357129.4171294727, 371521.67336433276, 386467.3004499118, 401986.9170588154, 418102.5177231561, 434837.52590668015, 452216.83756773314, 470266.85560486134, 489015.51581264695, 508492.3051835884, 528728.2735685676, 549756.0398513136]
Y_0 = []
for i in range(101):
    Y_0.append(Y_2[i]/Y_1[i])   
line1 = ax.plot(Time, Y_0, label = "比率")
print(Y)

ax.set_title("変化を加えない場合と5期のみ政府支出の伸び率縮小および5期以降政府負債の金利ゼロの場合のGDP比較")
ax.set_xlabel("期")
ax.set_ylabel("G\nD\nP\n比\n率", rotation=0, va='center')
ax.set_xlim(0,101)
ax.legend()
plt.grid()
plt.show()
